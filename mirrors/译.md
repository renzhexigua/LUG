# rsync #

### 22 9月 2014 ###

-------------------
-------------------

# rsync(1) #

### 22 9月 2014 ###

## 简介 ##
**rsync** --  一种快捷、多用途、用来远程（或本地）同步拷贝文件的工具
## 语法摘要 ##
<pre>
本地:  rsync [OPTION...] SRC... [DEST]

通过远程shell访问方式:  
   Pull: rsync [OPTION...] [USER@]HOST:SRC... [DEST]  
   Push: rsync [OPTION...] SRC... [USER@]HOST:DEST

通过rsync守护进程访问方式:  
  Pull: rsync [OPTION...] [USER@]HOST::SRC... [DEST]
        rsync [OPTION...] rsync://[USER@]HOST[:PORT]/SRC... [DEST]
  Push: rsync [OPTION...] SRC... [USER@]HOST::DEST
        rsync [OPTION...] SRC... rsync://[USER@]HOST[:PORT]/DEST
</pre>
通常，只指定一个`SRC`参数，而不指定`DEST`参数可以仅打印源端目标文件列表而不进行拷贝操作。
## 描述 ##
Rsync是一个快捷多功能的文件拷贝工具。它可以实现本地拷贝，也可以通过远程shell拷贝来自（或拷贝到）任何一台主机（或远程rsync守护进程）。它提供了很多参数选项用来控制拷贝操作的实现过程，比如灵活设置待拷贝文件的属性。Rsync用的是著名的delta-transfer 算法，只复制源文件和目的文件的差异部分，减少了网络带宽资源的占用并提高了复制的速度。Rsync广泛用于备份和镜像同步，并可以用作是一个增强版的复制命令来使用。
  
Rsync默认使用一种“快速检查”的算法去查找那些大小发生改变或者被最新修改过的待传输文件。快速检查会确定哪些文件内容需要更新，任何发生在源端目标文件属性（由参数指定）的变化都会被同步更新到目标文件上。

rsync的其他特性有：  

* 支持拷贝链接、设备、属主、组和其他属性权限
* 拥有和GNU tar打包工具类似的功能参数`exclude`和`exclude-from`
* CVS exclude模式会忽略掉那些在.cvsignore文件中存在的文件
* 可以使用任何的远程传输shell，包括ssh和rsh
* 不需要拥有超级用户权限
* 不间断文件传输最大限度地减少潜在的开销
* 支持匿名或者需要身份验证的rsync进程访问（特别适合镜像同步）

## 概述 ##
Rsync 支持从一个远端主机上拷贝文件到本地或者从本地拷贝文件到远端主机上，也支持本地拷贝（不支持在远端主机之间拷贝）  

有两种方式连接远端主机：通过远程shell程序作为传输方式（比如ssh、rsh）或者通过TCP协议直连到服务器端的rsync进程。远程shell传输方式是在指定主机名后加一个冒号(:)再跟上源或者目标文件路径；而利用rsync传输方式通常是在主机名后加上两个分号(::)再跟上源（或目标）文件路径或者使用`rsync://URL `格式来指定。

一个特例就是当仅指派一个源参数而不指定目标参数，则命令执行的结果等同于使用`ls -l`方式打印源文件列表。

另一个特例就是当既不指定源也不指定目标参数时，拷贝操作仅限于本地执行。（详见 `--list-only`参数选项）

Rsync把本地当做“客户机”而把远端主机当做“服务器”。不要把“服务”和rsync守护进程搞混淆 -- 守护进程始终是服务，但一个服务既可以是一个守护进程也可以是同时运行的多shell进程。

## 安装 ##
参考 **README** 安装手册。

一旦安装之后，你就可以通过远程shell方式（或者rsync守护进程协议）去访问任意主机。对于远程传输而言，初始默认配置是使用`rsh或remsh`方式连接主机，但一个更为现代的做法是改用`ssh`协议。

当然你也可以通过使用`-e`选项参数或者设置`RSYNC_RSH`环境变量去选择你喜欢的远程传输协议。

需要注意源和目标主机都应安装了此工具。

## 用法 ##
你可以像使用`rcp`一样使用`rsync`。你必须指定一个源地址和目标地址，它们之一可能会位于远端主机。

讲解语法的最好方法就是举例子：  

	rsync -t  *.c  foo:src/  
这个例子会把当前目录下所有匹配`*.c`的文件拷贝到主机 **foo** 的 **src** 目录下。如果有任何文件已经存在于远端主机上则rsync远程更新协议只会发送存在差异的那部分数据去更新远端主机上的文件。注意命令行中通配符（*.c）被展开为相匹配的文件列表这一动作是在执行rsync程序之前被shell解释器完成的而不是由rsync程序所执行（和其他满足POSIX标注的程序一样）。

	rsync -avz  foo:src/bar  /data/tmp  
这个例子会迭代地查找标主机foo **src/bar** 目录下的所有文件，然后整个目录全拷贝到本地的**/data/tmp** 下，生成一个新的 **bar** 目录。同时这些文件会以"**archive**"模式传送，确保在拷贝之后仍然可以保留源文件中的链接、设备、属性、权限、属主等性质。另外，采用压缩模式也可以用来减少传输过程中的带宽占用。

	rsync -avz  foo:src/bar/  /data/tmp  
源路径结尾处的斜线(/)可以防止在目标路径下额外创建一个相同的目录。你可以对比着理解结尾有斜线(/)是仅拷贝该目录 **下** 的所有内容（不包括目录文件），而不加斜线是直接拷贝整个目录（目录文件+目录下的文件），两种方法都能够保证源目录和目标目录下所包含内容得属性的一致性。换句话说，下面两种方式效果一样（包括目标路径 **/dest/foo** 属性的设置）

	rsync -av  /src/foo   /dest
	rsync -av  /src/foo/  /dest/foo  

注意只指定主机名和模块引用这两种方式不需要在结尾加斜线(/)，默认会拷贝目录下的所有内容。举例来说，下面的两种方式都会拷贝远端目录下的文件到本地 **/dest** 下面：

	rsync -av  host:  /dest
	rsync -av  host::module  /dest

你也可以使用rsync的本地模式，原路径和目标路径都不需要包含":".在这种情况下rsync更像是一个加强版的copy命令。  

最后，你可以不指定模块名称，通过一个rsync守护进程从远端主机上打印所有（可罗列的）模块的列表信息，如下：

	rsync somehost.mydomain.com::  

可以参考下面的章节获得更加详细的信息。